import{useEffect,useState}from"react";import supabase from"../supabase/supabase-client";export const useGetProfile=(e,a=0)=>{const[r,s]=useState(!0),[t,u]=useState(null),[l,i]=useState(null);useEffect((()=>{let a=!1;return(async()=>{if(!e||!e.user)return u(null),void s(!1);s(!0);const{user:r}=e;try{const{data:t,error:l}=await supabase.from("profiles").select("username, first_name, last_name, avatar_url").eq("id",r.id).single();a||(l?i(l):t&&(u({username:t.username,firstName:t.first_name||"",lastName:t.last_name||"",avatarUrl:t.avatar_url,email:e.user.email}),i(null)))}catch(e){a||i(e)}finally{a||s(!1)}})(),()=>{a=!0}}),[e,a]);return{loading:r,profile:t,error:l,updateProfile:async a=>{if(e&&e.user)try{const{error:r}=await supabase.from("profiles").upsert({id:e.user.id,...a,updated_at:new Date});if(r)throw r;const{data:s,error:t}=await supabase.from("profiles").select("username, first_name, last_name, avatar_url").eq("id",e.user.id).single();if(t)throw t;return u({username:s.username,firstName:s.first_name||"",lastName:s.last_name||"",avatarUrl:s.avatar_url,email:e.user.email}),{success:!0}}catch(e){return{success:!1,error:e}}}}};